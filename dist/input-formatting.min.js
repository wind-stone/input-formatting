!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.InputFormatting=e()}(this,function(){"use strict";function r(t,e){var n=m(t.initialValue,t.delimiters);e||(e=u(t));var i=t.format.length-e.length;return n.length>i&&(n=n.slice(0,i)),e.forEach(function(t){n.length<=t.index||t.index<n.length&&n.splice(t.index,0,t.value)}),n.join("")}function m(t,e){return e.reduce(function(t,e){return function(t,e){for(;-1<t.indexOf(e);)t=t.replace(e,"");return t}(t,e)},t).split("")}function u(t){var n=t.delimiters,i=[];return t.format.split("").forEach(function(t,e){-1<n.indexOf(t)&&i.push({index:e,value:t})}),i}var n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();return function(){function e(t){n(this,e),this._init(t)}return t(e,[{key:"_init",value:function(t){var e,n=t.input;if("string"==typeof n&&(n=document.querySelector(n)),!(n instanceof HTMLInputElement))return e="input is not a HTMLInputElement element",void console.error("[input-foratting]: "+e);this._initData(n,t),this._addInputHandler();var i=t.initialValue||n.value;i&&this._formatOnly(i)}},{key:"_initData",value:function(t,e){this.$input=t,this._options=e,this._lastInputLength=0,this._lastSelectionStart=0,this._isDelete=!1,this._delimiterArray=u(e),this._inputHandler=null,t.setAttribute("maxLength",e.format.length)}},{key:"_formatOnly",value:function(t){var e=this,n=this.$input,i=this._options;t=r({initialValue:t,delimiters:i.delimiters,format:i.format}),setTimeout(function(){n.value=t,e._lastInputLength=t.length,e._callAfterFormat(t)})}},{key:"_callBeforeFormat",value:function(t){var e=this._options.beforeFormat;if(e&&"function"==typeof e)return e.call(this,t)}},{key:"_callAfterFormat",value:function(t){var e=this._options.afterFormat;e&&"function"==typeof e&&e.call(this,t)}},{key:"_addInputHandler",value:function(){var c=this,h=this.$input,p=this._options.delimiters,d=void 0;this._inputHandler=function(){var t=!1,e=h.value,n=e.length,i=+h.getAttribute("maxlength"),r=m(e,p),u=r.join(""),o=c._callBeforeFormat(u);void 0!==o&&(r=m(e=o,p),t=!0);var l,a=c._lastInputLength<n,s=c._delimiterArray,f=h.selectionStart;if(void 0===d&&a&&(d=1===n&&0===f||c._lastSelectionStart===f),a&&d&&f++,1<Math.abs(n-c._lastInputLength))return c._formatOnly(e),setTimeout(function(){h.setSelectionRange(i,i)});s.forEach(function(t){r.length<=t.index||(a?f===t.index+1&&f++:f===t.index&&c._isDelete&&(r.splice(t.index-1,1),f--),t.index<r.length&&r.splice(t.index,0,t.value))}),l=h.value=r.join(""),c._lastInputLength=r.length,a&&f<l.length?s.some(function(t){if(t.index===f)return f++,!0}):f<l.length&&s.some(function(t){if(f===t.index+1)return f--,!0}),c._lastSelectionStart=f,setTimeout(function(){t?h.setSelectionRange(i,i):h.setSelectionRange(f,f),c._callAfterFormat(l)})},h.addEventListener("input",this._inputHandler,!1),h.addEventListener("keydown",function(t){8===t.keyCode?c._isDelete=!0:c._isDelete=!1},!1)}},{key:"_removeInputHandler",value:function(){this._inputHandler&&this.$input.removeEventListener("input",this._inputHandler)}},{key:"$stop",value:function(){this.$input&&(this._removeInputHandler(),this.$input.removeAttribute("maxLength"),this.$input.value="",this.$input=null,this._options=null,this._delimiterArray=null,this._inputHandler=null)}},{key:"$reset",value:function(t){this.$stop(),t.input=t.input||this.$input,this._init(t)}}],[{key:"format",value:function(t){return r(t)}}]),e}()});
