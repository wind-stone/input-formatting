!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.InputFormatting=n()}(this,function(){"use strict";function r(t,n){var e=m(t.initialValue,t.delimiters);n||(n=u(t));var i=t.format.length-n.length;return e.length>i&&(e=e.slice(0,i)),n.forEach(function(t){e.length<=t.index||t.index<e.length&&e.splice(t.index,0,t.value)}),e.join("")}function m(t,n){return n.reduce(function(t,n){return function(t,n){for(;-1<t.indexOf(n);)t=t.replace(n,"");return t}(t,n)},t).split("")}function u(t){var e=t.delimiters,i=[];return t.format.split("").forEach(function(t,n){-1<e.indexOf(t)&&i.push({index:n,value:t})}),i}var e=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},t=function(){function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}}();return function(){function n(t){e(this,n),this._init(t)}return t(n,[{key:"_init",value:function(t){var n,e=t.input;if("string"==typeof e&&(e=document.querySelector(e)),!(e instanceof HTMLInputElement))return n="input is not a HTMLInputElement element",void console.error("[input-foratting]: "+n);this._initData(e,t),this._addInputHandler();var i=t.initialValue||e.value;i&&this._formatOnly(i)}},{key:"_initData",value:function(t,n){this.$input=t,this._options=n,this._lastInputLength=0,this._lastSelectionStart=0,this._delimiterArray=u(n),this._inputHandler=null,t.setAttribute("maxLength",n.format.length)}},{key:"_formatOnly",value:function(t){var n=this,e=this.$input,i=this._options;t=r({initialValue:t,delimiters:i.delimiters,format:i.format}),setTimeout(function(){e.value=t,n._lastInputLength=t.length,n._callAfterFormat(t)})}},{key:"_callBeforeFormat",value:function(t){var n=this._options.beforeFormat;if(n&&"function"==typeof n)return n.call(this,t)}},{key:"_callAfterFormat",value:function(t){var n=this._options.afterFormat;n&&"function"==typeof n&&n.call(this,t)}},{key:"_addInputHandler",value:function(){var c=this,h=this.$input,p=this._options.delimiters,d=void 0;this._inputHandler=function(){var t=!1,n=h.value,e=n.length,i=+h.getAttribute("maxlength"),r=m(n,p),u=r.join(""),o=c._callBeforeFormat(u);void 0!==o&&(r=m(n=o,p),t=!0);var a,l=c._lastInputLength<e,s=c._delimiterArray,f=h.selectionStart;if(void 0===d&&l&&(d=1===e&&0===f||c._lastSelectionStart===f),l&&d&&f++,1<Math.abs(e-c._lastInputLength))return c._formatOnly(n),setTimeout(function(){h.setSelectionRange(i,i)});s.forEach(function(t){r.length<=t.index||(l?f===t.index+1&&f++:f===t.index&&(r.splice(t.index-1,1),f--),t.index<r.length&&r.splice(t.index,0,t.value))}),a=h.value=r.join(""),c._lastInputLength=r.length,l&&f<a.length?s.some(function(t){if(t.index===f)return f++,!0}):s.some(function(t){if(f===t.index+1)return f--,!0}),c._lastSelectionStart=f,setTimeout(function(){t?h.setSelectionRange(i,i):h.setSelectionRange(f,f),c._callAfterFormat(a)})},h.addEventListener("input",this._inputHandler,!1)}},{key:"_removeInputHandler",value:function(){this._inputHandler&&this.$input.removeEventListener("input",this._inputHandler)}},{key:"$stop",value:function(){this.$input&&(this._removeInputHandler(),this.$input.removeAttribute("maxLength"),this.$input.value="",this.$input=null,this._options=null,this._delimiterArray=null,this._inputHandler=null)}},{key:"$reset",value:function(t){this.$stop(),t.input=t.input||this.$input,this._init(t)}}],[{key:"format",value:function(t){return r(t)}}]),n}()});
